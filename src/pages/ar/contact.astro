---
import Layout from '../../layouts/Layout.astro';
import ContactHero from '../../components/contact/ContactHero';
import ContactBookingSection from '../../components/contact/ContactBookingSection';
import { t } from '../../i18n/index';
import { branches } from '../../data/branches';

const lang = Astro.currentLocale || 'ar';
const currentLang = lang;
const rtl = true;

// Prepare branches data for B2C form
const branchesForForm = branches.map(branch => ({
  id: branch.id,
  name: branch.name,
  market: branch.country === 'UAE' ? 'UAE' : 'EG'
}));

// Get query parameters for pre-filling form
const defaultBranchId = Astro.url.searchParams.get('branch') ?? undefined;
const defaultService = Astro.url.searchParams.get('service') ?? undefined;
---

<Layout title={t('pages.contact.title')} description={t('pages.contact.description')}>
  <!-- Contact Hero Section - Full viewport height with smooth scroll indicator -->
  <section class="relative">
    <ContactHero client:visible currentLocale={currentLang} isRTL={rtl} />
    
    <!-- Scroll indicator -->
    <div class="absolute bottom-8 left-1/2 transform -translate-x-1/2 animate-bounce">
      <div class="w-6 h-10 border-2 border-white/30 rounded-full flex justify-center">
        <div class="w-1 h-3 bg-white/60 rounded-full mt-2 animate-pulse"></div>
      </div>
    </div>
  </section>

  <!-- Main Content Container with improved spacing and visual flow -->
  <main class="relative">
    
    <!-- B2C Form & Interactive Map Section -->
    <section id="b2c-book" class="relative z-10 py-20 md:py-28 lg:py-32">
      <div class="container mx-auto px-4">
        <!-- Section introduction -->
        <div class="text-center mb-16">
          <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-red-500 to-orange-500 rounded-full mb-6">
            <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
            </svg>
          </div>
          <h2 class="text-3xl md:text-4xl font-bold text-white mb-4 bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent">
            {currentLang === 'ar' ? 'احجز موعد واحصل على عرض سعر' : 'Book & Quote'}
          </h2>
          <p class="text-gray-300 text-lg max-w-2xl mx-auto">
            {currentLang === 'ar' 
              ? 'احجز موعداً واحصل على عرض سعر مخصص لاحتياجات سيارتك'
              : 'Book an appointment and get a personalized quote for your vehicle needs'
            }
          </p>
        </div>
        
        <!-- Unified Contact Booking Section: B2C Form, Map, and Branch Locator -->
        <ContactBookingSection 
          client:only="react" 
          currentLocale={currentLang} 
          isRTL={rtl}
          locale={currentLang as "en" | "ar"}
          branchesForForm={branchesForForm}
          defaultBranchId={defaultBranchId}
          defaultService={defaultService}
        />
      </div>
    </section>

  </main>
</Layout>
